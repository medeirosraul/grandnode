@model OnePageCheckoutModel
@inject IWebHelper webHelper
@inject IPageHeadBuilder pagebuilder

@{
    Layout = "_ColumnsOneClean";

    pagebuilder.AddScriptParts(ResourceLocation.Footer, "~/scripts/public.accordion.js");
    pagebuilder.AddScriptParts(ResourceLocation.Footer, "~/Themes/Corujinha/Content/js/public.onepagecheckout.js");

    var storeLocation = webHelper.GetStoreLocation(true);

    //title
    pagebuilder.AddTitleParts(T("PageTitle.Checkout").Text);
}
@{
    //step numbers
    int billingAddressStepNumber = 1;
    int shippingAddressStepNumber = 2;
    int shippingMethodStepNumber = 3;
    int paymentMethodStepNumber = 4;
    int paymentInfoStepNumber = 5;
    int confirmOrderStepNumber = 6;
    if (!Model.ShippingRequired)
    {
        paymentMethodStepNumber = paymentMethodStepNumber - 2;
        paymentInfoStepNumber = paymentInfoStepNumber - 2;
        confirmOrderStepNumber = confirmOrderStepNumber - 2;
    }
    if (Model.DisableBillingAddressCheckoutStep)
    {
        shippingAddressStepNumber--;
        shippingMethodStepNumber--;
        paymentMethodStepNumber--;
        paymentInfoStepNumber--;
        confirmOrderStepNumber--;
    }
}
<script asp-location="Footer">
    $(".opc li.active").prev("li").removeClass("dontGo");
    $(".opc li.active").nextAll("li").addClass("dontGo");
</script>
<div class="page checkout-page">
    <div class="page-title-clean row">
        <h2>@T("Checkout")</h2>
    </div>
    <div class="row mt-3">
        <div id="one-page-checkout-accordion" class="accordion accordion-flush p-0">
            <div id="opc-billing" class="accordion-item">
                <h2 class="accordion-header">
                    <button type="button" class="accordion-button" data-bs-toggle="collapse" data-bs-target="#opc-billing-body" onclick="Checkout.disableSubsequents('billing');"><span class="icon-sm iconify me-2" data-icon="bi:check2"></span>Endereço</button>
                </h2>
                <div id="opc-billing-body" class="accordion-collapse collapse show" data-bs-parent="#one-page-checkout-accordion">
                    <div class="accordion-body">
                        <form id="co-billing-form" action="">
                            <div id="checkout-billing-load">
                                <partial name="OpcBillingAddress" model="Model.BillingAddress" />
                                @*billing address content will be loaded here*@
                            </div>
                        </form>
                        <script asp-location="Footer">
                        Billing.init('#co-billing-form', '@(storeLocation)checkout/OpcSaveBilling/', @(Model.DisableBillingAddressCheckoutStep.ToString().ToLowerInvariant()));
                        if ($("#billing-address-select").length > 0) {
                            Billing.newAddress(!$('#billing-address-select').val());
                        }
                        </script>
                        <div class="col-12 d-flex justify-content-end mt-2 mb-2">
                            <button type="button" title="@T("Common.Continue")" class="btn theme-btn-primary" onclick="Billing.save()">
                                <span class="icon-sm iconify me-2" data-icon="bi:hourglass-split" id="billing-please-wait" style="display: none;"></span> @T("Common.Continue")
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="opc-shipping" class="tab-section d-none">
                <div class="step-title card card-grey mb-1 text-left p-0 col-12 rounded-0">
                    <div class="card-body p-2">
                        <blockquote class="card-bodyquote">
                            <span>@T("Checkout.ShippingAddress")</span>
                        </blockquote>
                    </div>
                </div>
                <div id="checkout-step-shipping col-12" class="step mt-2 mb-2 a-item" style="display: none;">
                    <form action="" id="co-shipping-form">
                        <div id="checkout-shipping-load">
                            @*shipping address content will be loaded here*@
                        </div>
                    </form>
                    <script asp-location="Footer">
                            Shipping.init('#co-shipping-form', '@(storeLocation)checkout/OpcSaveShipping/');
                            if ($("#shipping-address-select").length > 0) {
                                Shipping.newAddress(!$('#shipping-address-select').val());
                            }
                    </script>
                    <div class="col-12 buttons pt-1 pb-1 px-0 my-3" id="shipping-buttons-container">
                        @if (!Model.DisableBillingAddressCheckoutStep)
                        {
                            <a class="btn btn-secondary" href="#" onclick="Checkout.back(); return false; ">@T("Common.Back")</a>

                        }
                        <input type="button" class="btn btn-info new-address-next-step-button" title="@T("Common.Continue")" onclick="Shipping.save()" value="Continuar" />
                        <span id="shipping-please-wait" class="please-wait" style="display: none;"> @T("Common.LoadingNextStep")</span>
                    </div>
                </div>
            </div>
            <div id="opc-shipping_method" class="accordion-item">
                <h2 class="accordion-header">
                    <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#opc-shipping_method-body" onclick="Checkout.disableSubsequents('shipping_method');"><span class="icon-sm iconify me-2" data-icon="bi:check2"></span>Método de envio</button>
                </h2>
                <div id="opc-shipping_method-body" class="accordion-collapse collapse" data-bs-parent="#one-page-checkout-accordion">
                    <div class="accordion-body">
                        <form id="co-shipping-method-form" action="">
                            <div id="checkout-shipping-method-load">
                                @*shipping methods content will be loaded here*@
                            </div>
                            <script asp-location="Footer">
                                ShippingMethod.init('#co-shipping-method-form', '@(storeLocation)checkout/OpcSaveShippingMethod/');
                            </script>
                            <div class="col-12 d-flex justify-content-end mt-2 mb-2" id="shipping-method-buttons-container">
                                <a class="btn btn-secondary me-2" href="#" onclick="Checkout.back(); return false;">Voltar</a>
                                <button type="button" class="btn theme-btn-primary" onclick="ShippingMethod.save()">
                                    <span class="icon-sm iconify me-2" data-icon="bi:hourglass-split" id="shipping-method-please-wait" style="display: none;"></span>
                                    @T("Common.Continue")
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div id="opc-payment_method" class="tab-section d-none">
                <div class="step-title card card-grey mb-1 text-left p-0 col-12 rounded-0">
                    <div class="card-body p-2">
                        <blockquote class="card-bodyquote">
                            <span>@T("Checkout.PaymentMethod")</span>
                        </blockquote>
                    </div>
                </div>
                <div id="checkout-step-payment-method" class="step mt-2 mb-2 a-item" style="display: none;">
                    <form action="" id="co-payment-method-form">
                        <div id="checkout-payment-method-load">
                            @*payment methods content will be loaded here*@ Payment is not required
                        </div>
                    </form>
                    <script asp-location="Footer">
                        PaymentMethod.init('#co-payment-method-form', '@(storeLocation)checkout/OpcSavePaymentMethod/');
                    </script>
                    <div class="col-12 buttons pt-1 pb-1 my-3 px-0" id="payment-method-buttons-container">
                        @if (paymentMethodStepNumber > 1)
                        {
                            <a class="btn btn-secondary" href="#" onclick="Checkout.back(); return false;">Voltar</a>
                        }
                        <input type="button" class="btn btn-info payment-method-next-step-button" onclick="PaymentMethod.save()" value="@T("Common.Continue")" />
                        <span class="please-wait" id="payment-method-please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                    </div>
                </div>
            </div>
            <div id="opc-payment_info" class="tab-section d-none">
                <div class="step-title card card-grey mb-1 text-left p-0 col-12 rounded-0">
                    <div class="card-body p-2">
                        <blockquote class="card-bodyquote">
                            <span>@T("Checkout.PaymentInfo")</span>
                        </blockquote>
                    </div>
                </div>
                <div id="checkout-step-payment-info" class="step mt-2 mb-2 a-item" style="display: none;">
                    <form action="" id="co-payment-info-form">
                        <div id="checkout-payment-info-load">
                            @*payment info content will be loaded here*@ Payment is not required
                        </div>
                    </form>
                    <script asp-location="Footer">
                        PaymentInfo.init('#co-payment-info-form', '@(storeLocation)checkout/OpcSavePaymentInfo/');
                    </script>
                    <div class="col-12 buttons pt-1 pb-1 my-3 px-0" id="payment-info-buttons-container">
                        @if (!Model.HasSinglePaymentMethod || paymentMethodStepNumber > 1)
                        {
                            <a class="btn btn-secondary" href="#" onclick="Checkout.back();return false;">Voltar</a>
                        }
                        <input type="button" class="btn btn-info payment-info-next-step-button" onclick="PaymentInfo.save()" value="Continuar" />
                        <span class="please-wait" id="payment-info-please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                    </div>
                </div>
            </div>

            <div id="opc-confirm_order" class="accordion-item">
                <h2 class="accordion-header">
                    <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#opc-confirm_order-body" onclick="Checkout.disableSubsequents('confirm_order');"><span class="icon-sm iconify me-2" data-icon="bi:check2"></span>Confirmação</button>
                </h2>
                <div id="opc-confirm_order-body" class="accordion-collapse collapse" data-bs-parent="#one-page-checkout-accordion">
                    <div class="accordion-body">
                        <div id="checkout-confirm-order-load">
                            @*confirm order content will be loaded here*@
                        </div>
                        <script asp-location="Footer">
                        ConfirmOrder.init('@(storeLocation)checkout/OpcConfirmOrder/', '@(storeLocation)checkout/completed/');
                        </script>
                        <div class="col-12 d-flex justify-content-end mt-2 mb-2" id="confirm-order-buttons-container">
                            <a class="btn btn-secondary me-2" href="#" onclick="Checkout.back(); return false;">Voltar</a>
                            <button type="button" class="btn theme-btn-primary confirm-order-next-step-button" onclick="ConfirmOrder.save()">
                                <span class="icon-sm iconify me-2" data-icon="bi:hourglass-split" id="confirm-order-please-wait" style="display: none;"></span>
                                <span class="icon-sm iconify me-2" data-icon="bi:credit-card"></span>
                                Confirmar e pagar
                            </button>
                        </div>
                        <div class="col-12 d-flex justify-content-end mb-2">
                            <span class="text-muted small lh-1" style="text-align:justify">Ao <strong>confirmar</strong> você será redirecionado para o pagamento onde poderá escolher a forma que quer pagar.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @await Component.InvokeAsync("Widget", new { widgetZone = "opc_content_before" })
    @await Component.InvokeAsync("Widget", new { widgetZone = "opc_content_after" })
</div>
<script asp-location="Footer">
    Checkout.init('@(storeLocation)cart/');
    Checkout.disableSubsequents('billing');
</script>